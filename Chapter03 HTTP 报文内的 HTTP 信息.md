# HTTP 报文内的 HTTP 信息

## 3.1 HTTP 报文

用于 HTTP 协议交互的信息被称为 HTTP 报文。请求端（客户端）的 HTTP 报文叫做请求报文，响应端（服务器端）的叫做响应报文。HTTP 报文大致可分为报文首部和报文主体两块。

![](https://s1.ax1x.com/2020/04/25/JyUR5q.png)



## 3.2 请求报文及响应报文的结构

![](https://s1.ax1x.com/2020/04/25/JyU42T.png)

![](https://s1.ax1x.com/2020/04/25/JyU7qJ.png)

## 3.2 编码提升传输速率

### 3.3.1 报文主体和实体主体的差异

- 报文（message）：是 HTTP 通信中的基本单位，由 8 位组字节流组成，通过 HTTP 通信传输。
- 实体（entity）：作为请求或响应的有效载荷数据被传输，其内容由实体首部和实体主体组成。

### 3.3.2 压缩传输的内容编码

向待发送邮件内增加附件时，为了使邮件容量变小，我们会先用 ZIP 压缩文件之后再添加附件发送。HTTP 协议中有一种被称为内容编码的功能也能进行类似的操作。内容编码指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。

![](https://s1.ax1x.com/2020/04/25/JywoM8.png)

常用的内容编码有以下几种。

- gzip
- compress
- deflate
- identity（不进行编码）

### 3.3.3 分割发送的分块传输编码

在 HTTP 通信过程中，请求的编码实体资源尚未全部传输完成之前，浏览器无法显示请求页面。在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。这种实体主体分块的功能称为分块传输编码。

![](https://s1.ax1x.com/2020/04/25/Jy0wwQ.png)

分块传输编码会将实体主体分成多个部分（块）。每一块都会用十六进制来标记块的大小，而实体主体的最后一块会使用 “0（CR+LF）” 来标记。使用分块传输编码的实体主体会由接收的客户端负责解码，恢复到编码前的实体主体。

## 3.4 发送多中数据的多部分对象集合

HTTP 协议中采纳了多部分对象集合，发送的一份报文主体内可含有多类型实体。通常是在图片或文本文件等上传时使用。多部分对象集合包含的对象如下。

- multipart/form-data：在 Web 表单文件上传时使用。
- multipart/byteranges：状态码 206（partial Content，部分内容）响应报文包含了多个范围的内容时使用。

![](https://s1.ax1x.com/2020/04/25/JyyVK0.png)

![](https://s1.ax1x.com/2020/04/25/JyyuaF.png)

## 3.5 获取部分内容的范围请求

以前，用户不能使用现在这种高速的带宽访问互联网，当时，下载一个尺寸稍大的图片或文件就已经很吃力了。如果下载过程中遇到网络中断的情况，那就必须重头开始。为了解决上述问题，需要一种可恢复的机制。所谓恢复是指能从之前下载中断处恢复下载。要实现该功能需要指定下载的实体范围。像这样，指定范围发送的请求叫做范围请求（Range Request）。对一份 10 000 字节大小的资源，如果使用范围请求，可以只请求5001~10 000 字节内的资源。

![](https://s1.ax1x.com/2020/04/25/JygUaT.png)

![](https://s1.ax1x.com/2020/04/25/Jy2Pe0.png)

## 3.6 内容协商返回最合适的内容

